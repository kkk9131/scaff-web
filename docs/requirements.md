# フェーズ1 要件定義書（PoC完成版）

## 1. 概要

施工現場向けの足場計画支援ツールのPoCとして、建物形状エディタを開発する。 ユーザーはブラウザ上で建物の外形・屋根・寸法・3D表示を直感的に生成できる。 フェーズ1では「足場計算」「見積り」は含めず、建物を正確に作成できることを完成基準とする。

## 2. 利用環境

- **端末**：PCブラウザ、タブレットブラウザ（レスポンシブ対応）
- **スマホ**：将来対応（フェーズ2以降）
- **ネット接続**：必須

## 3. 入出力形式

### 入力

- **テンプレ形状**：矩形・L字・T字・コの字
- **頂点追加／削除**で自由形状編集
- **サイドパネル**で各辺の寸法・軒の出・境界距離を数値入力
- **階層追加**（前階を複製して編集）＋高さ入力
- 各階ごとに**屋根設定可能**

### 出力

- **SVG**（必須、編集・ダウンロード）
- **JPEG**（簡易キャプチャ）
- **PDF**（見栄え調整した図面出力）

## 4. 平面図

- **Konva.js**で実装
- **頂点ドラッグ**で形状編集可能
- 各辺に**数値入力**で寸法・境界距離を調整
- **境界線**：オフセット生成＋自由ドラッグ可能
- 各**階層を切り替えて編集**

## 5. 立面図

- **北・南・東・西の4方向**を自動生成
- **寸法線**：外周寸法（パラペット上端まで）を「|──6000──|」形式でオフセット表示
- **屋根タイプ**：フラット／片流れ／切妻／寄棟
- **勾配表記**：斜辺中央に「10/〇」形式（0.5寸刻み）、角度は非表示
- **階層を積み上げて**高さ寸法を表示

## 6. 3D表示

- **Three.js**で外周ポリゴンをextrudeして高さを付与
- **屋根形状を反映**（フラット／片流れ／切妻／寄棟）
- **寸法表示なし**、形状確認専用
- 平面・立面編集と**同期して更新**

## 7. 開口部（PoC時点）

- **データ構造のみ保持**（ドア、矩形出窓のみ対応）
- **出窓**は出幅（depth）を持ち、将来的に立面・3Dで反映予定
- **UIでの入力・描画は未対応**

## 8. 階層管理

- ユーザーが任意で**階層を追加可能**
- 新規階層は**直下階の複製**から生成し編集可能
- 各階に**高さと屋根タイプ**を設定可能
- 立面・3D表示では**階ごとに積み上げて**表現

## 9. 寸法線仕様

- **外周寸法**：オフセット表示（両端に縦線「|」）、中央にmm単位の数値
- **屋根**：斜辺中央に「10/〇」（0.5寸刻み、小数あり、文字「勾配」はなし）
- **寸法線**はON/OFF切替可能

## 10. 技術スタック

### フロントエンド

- **Framework**：Next.js (React, TypeScript)
- **UI/Canvas**：Konva.js（平面図編集）、Tailwind CSS（UIスタイリング）
- **3D描画**：Three.js（建物押し出し＋屋根）
- **レスポンシブ**：Tailwind + CSS Grid/Flex

### 出力

- **SVG生成**：Konva.js／SVG API
- **JPEG出力**：html-to-image / dom-to-image
- **PDF出力**：jsPDF / pdf-lib

### 状態管理

- **React Hooks / Context API**（軽量実装）

### デプロイ

- **Vercel**（ホスティング）

## 11. 完成基準

- ブラウザで建物形状（平面・立面・3D）が作成可能
- SVG出力（必須）、JPEG/PDF出力対応
- 屋根4タイプ＋勾配表記「10/〇」
- 寸法線「|──6000──|」を正しく表示
- 複数階層の編集・表示が可能
- PC・タブレット両方でレスポンシブに利用可能
