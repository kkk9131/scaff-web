# 詳細開発ロードマップ (チェックリスト版)

## フェーズ1: PoC（概念実証）開発 - 建物形状エディタ

**目標:** 要件定義を満たす、高品質な建物形状エディタを完成させ、Vercel上で安定稼働させる。

---

### **マイルストーン1: 基盤構築とコアエディタ機能（スプリント 1）**

**ゴール:** ユーザーがブラウザ上で建物の基本形状を自由に描画・編集できる状態にする。

- [ ] **プロジェクトセットアップ**
    - [ ] `Next.js (TypeScript)` でプロジェクトを初期化
    - [ ] `ESLint`, `Prettier` を設定し、コード品質を統一
    - [ ] `Tailwind CSS` を導入し、基本的なスタイリング設定を完了
    - [ ] `components`, `hooks`, `utils`, `types` などのディレクトリ構造を整備
- [ ] **状態管理の設計**
    - [ ] `React Context API` を用いて、建物データ（頂点座標、階層情報など）を管理するためのグローバルストアを設計
- [ ] **平面図キャンバスの実装**
    - [ ] `Konva.js` をReactコンポーネントに統合
    - [ ] ストアの状態を元に、建��の外形ポリゴンをキャンバスに描画
- [ ] **インタラクティブな形状編集**
    - [ ] **頂点のドラッグ移動:** 頂点をドラッグすると形状がリアルタイムで更新される機能を実装
    - [ ] **頂点の追加・削除:** 辺をクリックして頂点を追加、頂点をダブルクリックして削除する機能を実装
- [ ] **テンプレート形状の読み込み**
    - [ ] UI（ボタン等）から「矩形」「L字」「T字」「コの字」を選択し、対応する初期形状をキャンバスに読み込む機能を実装

---

### **マイルストーン2: 寸法連携と立面図の自動生成（スプリント 2）**

**ゴール:** 作成した形状に正確な寸法を紐付け、それを基に4方向の立面図を自動で確認できるようにする。

- [ ] **UIパネルの実装**
    - [ ] `Tailwind CSS` を使い、寸法などを入力するためのサイドパネルUIを作成
    - [ ] 形状の各辺に対応する寸法入力フィールドを動的に生成
- [ ] **双方向の寸法連携**
    - [ ] **数値入力 → 形状反映:** サイドパネルで寸法を変更すると、`Konva.js` の形状が自動で更新されるロジックを実装
    - [ ] **形状編集 → 数値反映:** キャンバス上で頂点をドラッグすると、サイドパネルの寸法がリアルタイムに再計算・表示されるロジックを実装
- [ ] **立面図の自動生成**
    - [ ] 平面図の頂点データから、**北・南・東・西**の4方向の立面図データを計算する関数を実装
    - [ ] 計算結果を基に、SVGまたはCanvasで立面図を描画するコンポーネントを作成
- [ ] **立面図への寸法線表示**
    - [ ] 各立面図の外周寸法を計算し、「`|──6000──|`」形式の寸法線をオフセット表示する機能を追加

---

### **マイルストーン3: 3D表示と屋根形状の実装（スプリント 3）**

**ゴール:** 建物の形状を3Dで立体的に可視化し、主要な屋根タイプに対応させる。

- [ ] **3Dシーンのセットアップ**
    - [ ] `Three.js` と `@react-three/fiber`, `@react-three/drei` を導入
    - [ ] カメラ（視点操作可能）、ライト、背景などを含む基本的な3Dシーンを構築
- [ ] **建物の3Dモデル生成**
    - [ ] 平面図の2Dポリゴンデータと階高を基に、建物の壁を押し出し（Extrude）て3Dメッシュを生成
- [ ] **屋根形状のデータモデルとUI**
    - [ ] 状態管理ストアに、屋根タイプと勾配の情報を追加
    - [ ] サイドパネルに屋根タイプと勾���を入力するUIを設置
- [ ] **屋根の3Dジオメトリ生成**
    - [ ] 選択された屋根タイプと勾配に基づき、屋根の3Dメッシュを動的に生成するアルゴリズムを実装
- [ ] **ビューのリアルタイム同期**
    - [ ] 平面図や各種設定が変更された際に、立面図と3Dモデルが即座に再描画される同期機構を確立
- [ ] **立面図への屋根反映**
    - [ ] 立面図の描画ロジックを更新し、屋根形状と勾配表記（`10/〇`）を追加

---

### **マイルストーン4: 複数階層とファイル出力（スプリント 4）**

**ゴール:** 複数階層の建物を設計可能にし、成果物を標準的なファイル形式で出力できるようにする。

- [ ] **階層管理機能**
    - [ ] 状態管理のデータ構造を、複数階層を保持できる配列形式に拡張
    - [ ] 「階層を追加」「削除」「切り替え」るUIとロジックを実装
    - [ ] 各階層に個別の高さと屋根タイプを設定できるようにする
- [ ] **複数階層の描画**
    - [ ] 立面図と3Dビューで、各階層のデータを基に建物を積み上げて表示するように描画ロジックを更新
- [ ] **ファイル出力機能**
    - [ ] **SVG出力:** 平面図を編集可能なベクターデータとしてSVG形式でダウンロードする機能を実装
    - [ ] **JPEG出力:** `html-to-image` 等のライブラリを使用し、表示されているビューを画像として保存する機能を実装
    - [ ] **PDF出力:** `jsPDF` と `html-to-image` を組み合わせ、図面にタイトル等を付けてPDFとして出力する機能を実装

---

### **マイルストーン5: 仕上げ、レスポンシブ対応とデプロイ（スプリント 5）**

**ゴール:** PoCを製品レベルの品質に磨き上げ、関係者がいつでもアクセスできる状態で公開する。

- [ ] **レスポンシブ対応**
    - [ ] `Tailwind CSS` のブレークポイントを利用し、PCとタブレットの画面サイズでレイアウトを調整
- [ ] **データ構造の準備**
    - [ ] 開口部（ドア、窓）のデータ構造を状態管理ストア内に定義（UIは未実装）
- [ ] **総合テストと品質向上**
    - [ ] 全機能を通したE2E（エンドツーエンド）テストを実施
    - [ ] 各ブラウザ（Chrome, Safari, Firefox）での動作確認と表示崩れの修正
    - [ ] パフォーマンスのボトルネックがないか確認し、必要に応じて最適化
- [ ] **デプロイ**
    - [ ] `Vercel` にプロジェクトを連携し、CI/CDパイプライ��を構築
    - [ ] 本番環境での最終動作確認
